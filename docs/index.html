const canvas = document.getElementById('mandalaCanvas');
const ctx = canvas.getContext('2d');

let width, height, centerX, centerY;
let angle = 0;

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    centerX = width / 2;
    centerY = height / 2;
}

window.addEventListener('resize', resize);
resize();

function drawMandala() {
    // 画面を少しずつ暗くして残像を作る
    ctx.fillStyle = 'rgba(5, 5, 5, 0.1)';
    ctx.fillRect(0, 0, width, height);

    const petals = 8; // 対称軸の数

    ctx.save();
    ctx.translate(centerX, centerY);

    for (let i = 0; i < petals; i++) {
        ctx.save();
        ctx.rotate((Math.PI * 2 / petals) * i);
        
        // リサージュ図形を描画
        drawLissajous(angle, i);
        
        ctx.restore();
    }

    ctx.restore();
    angle += 0.02; // アニメーションの速度
    requestAnimationFrame(drawMandala);
}

function drawLissajous(t, index) {
    ctx.beginPath();
    // 虹色に変化させる
    ctx.strokeStyle = `hsla(${index * 45 + t * 50}, 80%, 60%, 0.6)`;
    ctx.lineWidth = 1.5;

    // リサージュ図形のパラメータ
    const a = 3; // 横の周波数
    const b = 2; // 縦の周波数
    const size = 150; // 図形の大きさ

    for (let i = 0; i <= Math.PI * 2; i += 0.1) {
        // リサージュの公式: x = sin(at + δ), y = sin(bt)
        const x = Math.sin(a * i + t) * size;
        const y = Math.sin(b * i) * size;
        
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    }
    ctx.stroke();
}

drawMandala();
